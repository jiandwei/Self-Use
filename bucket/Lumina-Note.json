{
    "version": "0.4.11",
    "description": "Lumina Note - A lightweight note-taking application",
    "homepage": "https://github.com/blueberrycongee/Lumina-Note",
    "license": "Unknown",
    "architecture": {
        "64bit": {
            "url": "https://github.com/blueberrycongee/Lumina-Note/releases/download/v0.4.11/lumina-note_0.4.11_x64-setup.exe",
            "hash": "f0c5aff7f8a56f5574e8a5bbc87d0d1cf48316fbd06a6aa2df5906708ba0ec61"
        }
    },
    "pre_install": [
        "Write-Host '正在使用7z解压安装程序...' -ForegroundColor Green",
        "# 查找下载的安装程序文件",
        "$installer = Get-ChildItem \"$dir\" -Filter '*.exe' | Select-Object -First 1",
        "if (-not $installer) {",
        "    throw '找不到安装程序文件'",
        "}",
        "$null = New-Item \"$dir\\_tmp\" -ItemType Directory -Force",
        "& '7z' x \"$($installer.FullName)\" -o\"$dir\\_tmp\" -y"
    ],
    "installer": {
        "script": [
            "Write-Host '正在提取程序文件...' -ForegroundColor Green",
            "# 检查解压后的结构",
            "$tmpDir = \"$dir\\_tmp\"",
            "# 先删除原始的安装程序文件",
            "Remove-Item \"$dir\\*.exe\" -Force",
            "",
            "# 如果lumina-note是一个可执行文件（不是文件夹）",
            "if (Test-Path \"$tmpDir\\lumina-note\" -PathType Leaf) {",
            "    Copy-Item \"$tmpDir\\lumina-note\" \"$dir\\lumina-note.exe\" -Force",
            "}",
            "# 如果lumina-note是一个文件夹",
            "elseif (Test-Path \"$tmpDir\\lumina-note\" -PathType Container) {",
            "    # 将文件夹内容复制到程序目录",
            "    Copy-Item \"$tmpDir\\lumina-note\\*\" \"$dir\\\" -Recurse -Force",
            "}",
            "else {",
            "    # 尝试查找任何exe文件",
            "    $exeFiles = Get-ChildItem \"$tmpDir\" -Filter '*.exe' -Recurse",
            "    foreach ($exe in $exeFiles) {",
            "        # 跳过uninstall相关的exe",
            "        if ($exe.Name -match 'uninstall|Uninst') {",
            "            continue",
            "        }",
            "        if ($exe.Name -match 'lumina-note|Lumina') {",
            "            Copy-Item $exe.FullName \"$dir\\lumina-note.exe\" -Force",
            "        }",
            "    }",
            "}",
            "",
            "# 清理临时目录",
            "Remove-Item \"$dir\\_tmp\" -Recurse -Force",
            "",
            "# 确认主程序文件存在",
            "if (-not (Test-Path \"$dir\\lumina-note.exe\")) {",
            "    # 尝试重命名现有的exe文件",
            "    $exeFile = Get-ChildItem \"$dir\" -Filter '*.exe' | Select-Object -First 1",
            "    if ($exeFile) {",
            "        Rename-Item \"$dir\\$($exeFile.Name)\" \"lumina-note.exe\" -Force",
            "    } else {",
            "        Write-Host '警告：未找到主程序文件' -ForegroundColor Yellow",
            "    }",
            "}"
        ]
    },
    "bin": "lumina-note.exe",
    "shortcuts": [
        [
            "lumina-note.exe",
            "Lumina Note"
        ]
    ],
    "checkver": {
        "github": "https://github.com/blueberrycongee/Lumina-Note"
    },
    "autoupdate": {
        "architecture": {
            "64bit": {
                "url": "https://github.com/blueberrycongee/Lumina-Note/releases/download/v$version/lumina-note_$version_x64-setup.exe"
            }
        }
    }
}
